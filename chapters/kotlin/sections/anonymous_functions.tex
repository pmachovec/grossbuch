\newsection{Anonymous Functions and Function Types}
\index{Anonymous function}
\index{Function type}
\label{kotlinanonymousfunction}
Kotlin supports syntax similar to~JavaScript, where anonymous functions can~be assigned to~variables --~in~Kotlin, functions are \hyperref[firstclass]{first class citizens}.
Such~functions can~be then invoked by calling the~variable name or~passed to~another function as~arguments.
The~other function is then a~function of~higher order.

When~specifying a~type of~a~variable holding a~function (which is the~case especially for~function parameters, standalone variables usually don't need type specification), you~must follow the~syntax \mbitqls{(TYPE\_1,;;;TYPE\_2,;;;...);;;->;;;RETURN\_TYPE}, where \mbitqls{(TYPE\_1,;;;TYPE\_2,;;;...)} are~types of~the~function parameters and~\mbitq{RETURN\_TYPE} is the~function return value type.
Mind brackets by the~function parameter types.
They're compulsory even when the~function has only one parameter, or~even zero.
\hyperref[kotlinunit]{\textit{Unit}} (and~even \hyperref[kotlinnothing]{\textit{Nothing}}) type is available for~functions returning no value.
\newline

\example
%! language = TEXT
\begin{lstlisting}[language=Kotlin]
    // Function of type "(Int) -> Int"
    val multiplyByTwo = fun (a: Int) : Int {
        return a * 2
    }

    // Function of type "() -> Unit"
    val doNothing = fun () {}
\end{lstlisting}
\newline

%! language = TEXT
\begin{lstlisting}[language=Kotlin, title={Function taking other functions as parameters}]
    fun doSomething(
        value: Int,
        oneArgFunction: (Int) -> Int,
        nothingFunction: () -> Unit
    ) : Int {
        nothingFunction()
        return oneArgFunction(value)
    }
\end{lstlisting}
\newline

%! language = TEXT
\begin{lstlisting}[language=Kotlin, title={Usage}]
    // Standalone invocation
    val result1 = multiplyByTwo(2) // Result is 4
    doNothing() // Doesn't return a value

    // Passing to another function
    val result2 = doSomething(3, multiplyByTwo, doNothing) // Result is 6
\end{lstlisting}
\newpage

\warningnonl It's~impossible to~get or~print the~function type from a~variable holding an~anonymous function.
Kotlin approach to~retrieve a~variable type is based on~retrieving the~variable class by~\hyperref[kotlinreflection]{reflection}.
But~anonymous functions aren't proper instances of~any class, therefore, the~approach doesn't work for~them.

\newsubsection{Receiver Type}
\index{Receiver type}
\label{kotlinanonymousreceivertype}
When defining an~anonymous function, it's~possible to~specify one concrete class denoted as \textit{receiver type}.
An~instance of~that class --~a~\textit{receiver} --~must then be given whenever the~function is invoked.
It~can~be also viewed as the~function can~be called only on~instances of~the~receiver type.

In~the~function definition, the~receiver type class name prepends parameter brackets with the~dot.
When the~function is~called, the~receiver type instance must~be either given as~the~first argument (the~call gets one argument more than the~number of function parameters) or~the~function can~be called on~the~instance with~the~dot notation (the~variable holding the~anonymous function works like \hyperref[kotlinextension]{extension}).
In~the~function body, the~receiver type instance is accessible by the~keyword~\textit{this}.

The~receiver type is reflected in~the~function type.
As~might~be expected, it~prepends the~parameter types brackets with the~dot.
\newline

\example
%! language = TEXT
\begin{lstlisting}[language=Kotlin]
    // Function of type "Int.(Int) -> Int"
    val multiplyByNumber = fun Int.(a: Int) : Int {
        return this * a
    }

    // Function of type "String.() -> Unit"
    val doNothingOnString = fun String.() {}
\end{lstlisting}
\newline

%! language = TEXT
\begin{lstlisting}[language=Kotlin, title={Usage with passing receivers as arguments}]
    multiplyByNumber(2, 3) // Receiver is "2"
    doNothing("abc") // Receiver is "abc"
\end{lstlisting}
\newline

%! language = TEXT
\begin{lstlisting}[language=Kotlin, title={Equivalent with calling on receivers}]
    2.multiplyByNumber(3)
    "abc".doNothing()
\end{lstlisting}
\newpage
