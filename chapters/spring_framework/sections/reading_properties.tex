\newsection{Reading values from \textit{.properties} files}
\index{Properties file}
Files with the~\mboxtextit{.properties} extension are~popular approach for~dynamic applications configuration. They're simple text files in~which each line has the~form \textit{identifier=value}. When a~\mboxtextit{.properties} file is~added to a~Spring application \hyperref[classpath]{classpath}, it~can~be referenced in~the~Spring configuration file, as~well as values specified in~the~file.

The~\mboxtextit{.properties} file is~referenced in~the~element \mboxtextit{property--placeholder}, attribute \textit{location}, from the~\hyperref[namespaces]{namespace} \textit{\href{http://www.springframework.org/schema/context}{http://www.springframework.org/schema/context}}. The~name of~the~\mboxtextit{.properties} file in~the~attribute \textit{location} must~be preceded by the~part referring to~the~\hyperref[classpath]{classpath}, which~is literally "\textit{classpath:}" (with the~colon).

Values set in~the~\mboxtextit{.properties} file can be then referenced as attribute values, typically when \hyperref[injectingliteralvalues]{injecting literal values}, but~can~be used also as bean~IDs when injecting complex beans. A~concrete value is~accessed by the~syntax~\textit{\$\{identifier\}}.\\

\warning The~default encoding of~\mboxtextit{.properties} files is~\mbox{ISO~8859--1}, in~which all non--ASCII characters are~written in~the~escaped hexadecimal format (\textit{\textbackslash uAB12}). If~you~put real non--ASCII characters into string values, they won't be processed correctly. Some IDEs and~editors even won't let you to~do~that as they automatically insert the~escaped hexadecimal format as~you~type. UTF--8 encoding is possible. First make sure the~file is~saved in~that format, some IDEs and~editors tend to~preserve the~\mbox{ISO~8859--1} for~\mboxtextit{.properties} files regardless corresponding project settings. And~next add the~attribute \mboxtextit{file--encoding} with the~value \mboxtextit{utf--8} to~the~element \mboxtextit{property--placeholder}. Ignore any~eventual warning about invalid encoding for~the~file type.\\

\warning Some IDEs (IntelliJ Idea for example) can~try to~"help" developers by~fake replacing the~dollar syntax with values from the~\mboxtextit{.properties} file. I.e.,~it~looks like values are~specified directly in~the~XML file. The~indicator of~this "replacement" is that values have different color (gray in IntelliJ). If~you click on~such value, the~original dollar notation will appear.

\note Using the~\mboxtextit{.properties} extension is only a~convention for~key--value files. The~name can~be anything, the~important thing is the~format "\textit{key\,=\,value}".
\newpage

\example[passing values to a constructor]
\begin{lstlisting}[title={A \mboxtextit{.properties} file called \tikzmarknodebf{readprop1prop1filename}{\textit{constructor.properties}}}]
    (*\tikzmarknodebf{readprop1prop1intvalue}{intvalue}*)=1
    (*\tikzmarknodebf{readprop1prop1floatvalue}{floatvalue}*)=3.14
    (*\tikzmarknodebf{readprop1prop1stringvalue}{stringvalue}*)=String value
\end{lstlisting}
\begin{lstlisting}[language=XML, title={Configuration XML}]
    <?xml version="1.0" encoding="UTF-8"?>
    <beans ...
           xmlns:context="http://www.springframework.org/schema/context"
           ...>
      <(*\textcolor{blue}{context:}*)property-placeholder location="classpath:(*\tikzmarknodebf{readprop1xml1filename}{constructor.properties}[ForestGreen]*)" file-encoding="utf-8"/>
      <bean id="someBeanId" class="(*\tikzmarknodebf{readprop1xml1package}{somepackage.subpackage}[ForestGreen]*).(*\tikzmarknodebf{readprop1xml1class}{WantedClass}[ForestGreen]*)">
        <constructor-arg value="(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop1xml1intvalue}{intvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)"/>
        <constructor-arg value="(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop1xml1floatvalue}{floatvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)"/>
        <constructor-arg value="(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop1xml1stringvalue}{stringvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)"/>
      </bean>
    </beans>
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Wanted class with the constructor}]
    package (*\tikzmarknodebf{readprop1java1package}{somepackage.subpackage}*);

    public class (*\tikzmarknodebf{readprop1java1class}{WantedClass}*) implements WantedInterface {
        private int intValueField;
        private float floatValueField;
        private String stringValueField;

        public (*\tikzmarknodebf{readprop1java1class2}{WantedClass}*)(int intValue, float floatValue, String stringValue) {
            intValueField = intValue;
            floatValueField = floatValue;
            stringValueField = stringValue;
        }

        public WHATEVER useValues() {
            ...DO SOMETHING WITH VALUE FIELDS...
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{readprop1prop1filename}{[xshift=6mm] readprop1xml1filename.north}
    \drawarrow{readprop1prop1intvalue.south east}{[xshift=-6mm] readprop1xml1intvalue.north east}[red]
    \drawarrow{readprop1prop1floatvalue}{[xshift=-3mm] readprop1xml1floatvalue.north}[green]
    \drawarrow{[xshift=6mm] readprop1prop1stringvalue.south west}{readprop1xml1stringvalue.north west}[blue]
    \drawarrow{readprop1xml1package}{readprop1java1package}[yellow][.5]
    \drawarrow{readprop1xml1class.south}{readprop1java1class}[Magenta]
    \drawarrow{readprop1xml1class.south}{readprop1java1class2}[Magenta]
\end{tikzpicture}
\newpage

\enlargethispage{20mm}
\thispagestyle{empty}
\example[passing values to setters]
\begin{lstlisting}[title={A \mboxtextit{.properties} file called \tikzmarknodebf{readprop2prop1filename}{\textit{setters.properties}}}]
    (*\tikzmarknodebf{readprop2prop1intvalue}{intvalue}*)=1
    (*\tikzmarknodebf{readprop2prop1floatvalue}{floatvalue}*)=3.14
    (*\tikzmarknodebf{readprop2prop1stringvalue}{stringvalue}*)=String with spaces
\end{lstlisting}
\begin{lstlisting}[language=XML, title={Configuration XML}]
    <?xml version="1.0" encoding="UTF-8"?>
    <beans ...
           xmlns:context="http://www.springframework.org/schema/context"
           ...>
      <(*\textcolor{blue}{context:}*)property-placeholder location="classpath:(*\tikzmarknodebf{readprop2xml1filename}{setter.properties}[ForestGreen]*)" file-encoding="utf-8"/>
      <bean id="someBeanId" class="(*\tikzmarknodebf{readprop2xml1package}{somepackage.subpackage}[ForestGreen]*).(*\tikzmarknodebf{readprop2xml1class}{WantedClass}[ForestGreen]*)">
        <property name="(*\tikzmarknodebf{readprop2xml1intvaluefield}{intValueField}[ForestGreen]*)" value="(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop2xml1intvalue}{intvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)"/>
        <property name="(*\tikzmarknodebf{readprop2xml1floatvaluefield}{floatValueField}[ForestGreen]*)" value="(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop2xml1floatvalue}{floatvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)"/>
        <property name="(*\tikzmarknodebf{readprop2xml1stringvaluefield}{stringValueField}[ForestGreen]*)" value="(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop2xml1stringvalue}{stringvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)"/>
      </bean>
    </beans>
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Wanted class with the zero--parameter constructor and setter methods}]
    package (*\tikzmarknodebf{readprop2java1package}{somepackage.subpackage}*);

    public class (*\tikzmarknodebf{readprop2java1class}{WantedClass}*) implements WantedInterface {
        private int intValueField;
        private float floatValueField;
        private String stringValueField;

        public (*\tikzmarknodebf{readprop2java1class2}{WantedClass}*)() {}

        public void set(*\tikzmarknodebf{readprop2java1intvaluefield}{IntValueField}*)(int intValue) {
            intValueField = intValue;
        }

        public void set(*\tikzmarknodebf{readprop2java1floatvaluefield}{FloatValueField}*)(float floatValue) {
            floatValueField = floatValue;
        }

        public void set(*\tikzmarknodebf{readprop2java1stringvaluefield}{StringValueField}*)(string stringValue) {
            stringValueField = stringValue;
        }

        public WHATEVER useValues() {
            ...DO SOMETHING WITH VALUE FIELDS...
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{readprop2prop1filename}{readprop2xml1filename}
    \drawarrow{readprop2prop1intvalue.south east}{[xshift=-6mm] readprop2xml1intvalue.north east}[red]
    \drawarrow{readprop2prop1floatvalue}{[xshift=-3mm] readprop2xml1floatvalue.north}[green]
    \drawarrow{[xshift=6mm] readprop2prop1stringvalue.south west}{readprop2xml1stringvalue.north west}[blue]
    \drawarrow{readprop2xml1package.west}{[xshift=-6mm] readprop2java1package.north}[yellow][.5][bend right=40mm]
    \drawarrow{readprop2xml1class.south}{readprop2java1class}[Magenta][.3][bend left=12mm]
    \drawarrow{readprop2xml1class.south}{readprop2java1class2}[Magenta][.3][bend left=12mm]
    \drawarrow{readprop2xml1intvaluefield.south}{readprop2java1intvaluefield.north}[YellowOrange]
    \drawarrow{readprop2xml1floatvaluefield.south}{readprop2java1floatvaluefield.north}
    \drawarrow{[xshift=3mm] readprop2xml1stringvaluefield.south}{[xshift=3mm] readprop2java1stringvaluefield.north}[red]
\end{tikzpicture}
\newpage

\newsubsection{Using Java Annotations}
\label{readingpropertiesannotations}
Passing values through the~configuration XML file can~be~avoided with the~\textit{Value} \hyperref[javaannotation]{annotation}. These annotations are~placed to~bean class fields to~which values should be injected. The~annotation gets one parameter\,--\,the~value identifier in~the~dollar syntax (\textit{\$\{identifier\}}) as~String in~quotes. Related fields aren't mentioned in~constructors nor~in~setter methods, they're set automatically.

\warning When combined with annotations of~the~\hyperref[iocannotations]{inversion of~control} or~the~\hyperref[autowiring]{dependency injection}, the~\textit{property-placeholder} element must go after the~\textit{component-scan} element.

\enlargethispage{20mm}
\thispagestyle{empty}
\example
\begin{lstlisting}[title={A \mboxtextit{.properties} file called \tikzmarknodebf{readprop3prop1filename}{\textit{annotations.properties}}}]
    (*\tikzmarknodebf{readprop3prop1intvalue}{intvalue}*)=1
    (*\tikzmarknodebf{readprop3prop1floatvalue}{floatvalue}*)=3.14
    (*\tikzmarknodebf{readprop3prop1stringvalue}{stringvalue}*)=String with spaces
\end{lstlisting}
\begin{lstlisting}[language=XML, title={Configuration XML}]
    <?xml version="1.0" encoding="UTF-8"?>
    <beans ...
           xmlns:context="http://www.springframework.org/schema/context"
           ...>
      <(*\textcolor{blue}{context:}*)component-scan base-package="(*\tikzmarknodebf{readprop3xml1package}{somepackage.subpackage}[ForestGreen]*)"/>
      <(*\textcolor{blue}{context:}*)property-placeholder location="classpath:(*\tikzmarknodebf{readprop3xml1filename}{annotations.properties}[ForestGreen]*)" file-encoding="utf-8"/>
    </beans>
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Wanted class with any constructor}]
    package (*\tikzmarknodebf{readprop3java1package}{somepackage.subpackage}*);

    public class WantedClass implements WantedClassInterface {
        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop3java1intvalue}{intvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private int intValueField;

        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop3java1floatvalue}{floatvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private float floatValueField;

        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop3java1stringvalue}{stringvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private String stringValueField;

        public WantedClass(...) {...}

        public WHATEVER useValues() {
            ...DO SOMETHING WITH VALUE FIELDS...
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{readprop3prop1filename}{readprop3xml1filename}
    \drawarrow{[xshift=6mm] readprop3prop1intvalue.south west}{[xshift=3mm] readprop3java1intvalue.north west}[red]
    \drawarrow{readprop3prop1floatvalue.north}{readprop3java1floatvalue.north}[green]
    \drawarrow{[xshift=-6mm] readprop3prop1stringvalue.south east}{[xshift=-6mm] readprop3java1stringvalue.north east}[blue]
    \drawarrow{readprop3xml1package}{readprop3java1package}[Magenta]
\end{tikzpicture}
\newpage

\newsubsection{Configuration with Java Code (No XML)}
When using the~Java configuration class, you~must annotate the~class with the~\mboxtextit{PropertySource} annotation. It~takes the~\mboxtextit{.properties} file name with the~\mboxtextit{classpath:} prefix as~a~parameter. When your \mboxtextit{.properties} file has~the~UTF--8 encoding, you~must use named parameters\,--\,the~file name parameter is~called \textit{value} and~the~encoding parameter is~called \textit{encoding}. It~works for~both component scan and~explicit bean configuration.

Values in~bean classes are~accessed in~the~same way as~when \hyperref[readingpropertiesannotations]{using annotations}\,--\,variables holding values are~annotated with the~\textit{Value} annotation holding the~value identifier from the~\mboxtextit{.properties} file in~curly brackets prefixed by the~dollar sign (\mboxtextit{\$\{identifier\}}). Related fields aren't mentioned in~constructors nor~in~setter methods, they're set automatically.

\enlargethispage{20mm}
\thispagestyle{empty}
\example[component scan]
\begin{lstlisting}[title={A \mboxtextit{.properties} file called \tikzmarknodebf{readprop4prop1filename}{\textit{annotations.properties}}}]
    (*\tikzmarknodebf{readprop4prop1intvalue}{intvalue}*)=1
    (*\tikzmarknodebf{readprop4prop1floatvalue}{floatvalue}*)=3.14
    (*\tikzmarknodebf{readprop4prop1stringvalue}{stringvalue}*)=String with spaces
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Configuration class}]
    package confpackage.confsubpackage;

    @>@Configuration
    @@>@ComponentScan<@@("(*\tikzmarknodebf{readprop4java1package}{somepackage.subpackage}[ForestGreen]*)")
    @@>@PropertySource<@@(value = "classpath:(*\tikzmarknodebf{readprop4java1filename}{annotations.properties}[ForestGreen]*)", encoding = "utf-8")
    public class ConfigurationClass {}
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Wanted class with any constructor}]
    package (*\tikzmarknodebf{readprop4java2package}{somepackage.subpackage}*)

    public class WantedClass implements WantedClassInterface {
        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop4java2intvalue}{intvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private int intValueField;

        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop4java2floatvalue}{floatvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private float floatValueField;

        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop4java2stringvalue}{stringvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private String stringValueField;

        public WantedClass(...) {...}

        public WHATEVER useValues() {
            ...DO SOMETHING WITH VALUE FIELDS...
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{readprop4prop1filename}{readprop4java1filename}
    \drawarrow{[xshift=6mm] readprop4prop1intvalue.south west}{[xshift=3mm] readprop4java2intvalue.north west}[red]
    \drawarrow{readprop4prop1floatvalue.north}{readprop4java2floatvalue.north}[green]
    \drawarrow{[xshift=-6mm] readprop4prop1stringvalue.south east}{[xshift=-6mm] readprop4java2stringvalue.north east}[blue]
    \drawarrow{readprop4java1package}{readprop4java2package}[Magenta]
\end{tikzpicture}
\newpage

\example[explicit bean configuration]
\begin{lstlisting}[title={A \mboxtextit{.properties} file called \tikzmarknodebf{readprop5prop1filename}{\textit{annotations.properties}}}]
    (*\tikzmarknodebf{readprop5prop1intvalue}{intvalue}*)=1
    (*\tikzmarknodebf{readprop5prop1floatvalue}{floatvalue}*)=3.14
    (*\tikzmarknodebf{readprop5prop1stringvalue}{stringvalue}*)=String with spaces
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Configuration class}]
    package confpackage.confsubpackage;

    @>@Configuration
    @@>@PropertySource<@@(value = "classpath:(*\tikzmarknodebf{readprop5java1filename}{annotations.properties}[ForestGreen]*)", encoding = "utf-8")
    public class ConfigurationClass {
        @>@Bean
        public WantedClassInterface wantedBeanMethod() {
            return new (*\tikzmarknodebf{readprop5java1class}{WantedClass}*)(...);
        }
    }
\end{lstlisting}
\begin{lstlisting}[language=Java, title={Wanted class with any constructor}]
    package somepackage.subpackage;

    public class (*\tikzmarknodebf{readprop5java2class}{WantedClass}*) implements WantedClassInterface {
        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop5java2intvalue}{intvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private int intValueField;

        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop5java2floatvalue}{floatvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private float floatValueField;

        @@>@Value<@@("(*\textcolor{ForestGreen}{\$\{}\tikzmarknodebf{readprop5java2stringvalue}{stringvalue}[ForestGreen]\textcolor{ForestGreen}{\}}*)")
        private String stringValueField;

        public (*\tikzmarknodebf{readprop5java2class2}{WantedClass}*)(...) {...}

        public WHATEVER useValues() {
            ...DO SOMETHING WITH VALUE FIELDS...
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{readprop5prop1filename}{readprop5java1filename}
    \drawarrow{[xshift=6mm] readprop5prop1intvalue.south west}{[xshift=3mm] readprop5java2intvalue.north west}[red]
    \drawarrow{readprop5prop1floatvalue.north}{readprop5java2floatvalue.north}[green]
    \drawarrow{[xshift=-6mm] readprop5prop1stringvalue.south east}{[xshift=-6mm] readprop5java2stringvalue.north east}[blue]
    \drawarrow{readprop5java1class.south}{[xshift=3mm] readprop5java2class.north}[Magenta]
    \drawarrow{readprop5java1class.south}{readprop5java2class2}[Magenta]
\end{tikzpicture}
\newpage