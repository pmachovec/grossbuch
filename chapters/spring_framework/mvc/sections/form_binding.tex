\newsection{Binding Form Values to Model}
So~far when a~form was~submitted, its values\,--\,request parameters\,--\,were extracted manually one by~one.
But~there's a~possibility to~automatically encapsulate them into \hyperref[pojo]{POJOs}, which are~available as~the~model attributes.
I.e.,~instead of reading request parameters separately and~inserting them to~some POJOs for~further processing (e.g.,~storing to~a~database), you~get those POJOs directly.

\newsubsection{Inputs with values provided by users}
This is a~simple use case.
In~a~form there's a~"free" value input field (text, number, email) where a~user can~type any~value matching the~field type (absolutely anything to~a~text field, any~number to~a~number field etc.).
The~input has~a~Thymeleaf attribute \mbit{th:field} used for~mapping to~a~POJO field.
For~such~input a~field with a~getter and~a~setter with matching names are~created in~the~desired POJO class and~Spring simply assigns the~typed value to~the~field.
Yes,~there's a~possibility of~type mismatch (e.g.,~text inserted to~an~integer field) and~the~code must~be prepared for~it.
Usual trick is~to~have POJO fields all String and~convert them to~other types in~try--catch blocks deeper in~the~program.
The~POJO must~be already present in~the~model when the~form is~submitted.
Because of~this the~POJO must~be created and~inserted to~the~model in~the~controller method responsible for~displaying the~form.

\newsubsection{Inputs with fixed values}
For~dropdowns the~principle is completely the~same as~for~"free" inputs.
There's a~field with a~getter and~a~setter with names matching the~\mbit{th:field} attribute of~the~\mbit{select} element in~the~form and~a~selected value (content of~the~\textit{value} attribute of~the~\textit{option} element) is~assigned to~the~field.

For~inputs without an~enclosing parent element, like radios and~checkboxes, there's a~slight difference.
The~identifying attribute (which appears in~each input element), is~the~original HTML \mbit{name}, not~the~Thymeleaf \mbit{th:field}.
Getters and~setters of~POJO fields must match that~one.

Inputs with fixed values can~be generated from a~collection in~the~code (map, list,\dots) or~even from a~\hyperref[properties]{\mbit{properties}} file.
A~\mbit{properties} file must~be included in~the~Spring configuration, retrieved in~the~controller and~added to~the~model as~a~separate attribute.
Iteration over the~collection members is~performed by~the~Thymeleaf attribute \mbit{th:each}.
For~dropdowns this attribute is~assigned to~a~single \mbit{option} element.
For~radios and~checkboxes there must~be a~single \mbit{input} element enclosed in~a~special Thymeleaf element \mbit{th:block} and~this element gets the~\mbit{th:each} attribute.

It's~also possible to~bind inputs enabling to~set multiple values, like checkboxes and~multiselects.
For~such inputs POJO fields must~be arrays, not~simple strings.
\newpage

\examplenonl[binding text input to \hyperref[pojo]{POJO} String field]
\enlargethispage{20mm}
\thispagestyle{empty}
%! language = TEXT
\begin{lstlisting}[language=Java, title={POJO class with one String field}]
    public class (*\tmnbf{smvc3java1pojo}{PojoClass}*) {
        private String pojoField;

        public String get(*\tmnbf{smvc3java1field1}{PojoField}*)() {
            return pojoField;
        }

        public String set(*\tmnbf{smvc3java1field2}{PojoField}*)(String pojoField) {
            this.pojoField = pojoField;
        }
    }
\end{lstlisting}
%! language = TEXT
\begin{lstlisting}[language=XML, title={HTML form setting the field}]
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org">
      ...
      <body>
        <form method="post" th:object="(*\Sc*){(*\tmnbf{smvc3xml1mapping}{mappingId}[ForestGreen]*)}" th:action="@{(*\tmnbf{smvc3xml1class}{/classUrl}[ForestGreen]\tmnbf{smvc3xml1meth}{/methodUrl}[ForestGreen]*)}">
          <input type="text" th:field="*{(*\tmnbf{smvc3xml1field}{pojoField}[ForestGreen]*)}">
        </form>
      </body>
    </html>
\end{lstlisting}
%! language = TEXT
\begin{lstlisting}[language=Java, title={Controller displaying and processing the form}]
    @>@Controller
    @@>@RequestMapping<@@("(*\tmnbf{smvc3java2class}{/classUrl}[ForestGreen]*)")
    public class ControllerClass {
        @>@RequestMapping
        public String showForm(Model model) {
            // Adding the POJO to model
            model.addAttribute("(*\tmnbf{smvc3java2mapping1}{mappingId}[ForestGreen]*)", new (*\tmnbf{smvc3java2pojo1}{PojoClass}*)())
            return "theForm"
        }

        @@>@RequestMapping<@@("(*\tmnbf{smvc3java2meth}{/methodUrl}[ForestGreen]*)")
        public String processForm(@@>@ModelAttribute<@@("(*\tmnbf{smvc3java2mapping2}{mappingId}[ForestGreen]*)") (*\tmnbf{smvc3java2pojo2}{PojoClass}*) pojo) {
            String pojoField = pojo.getPojoField();
            ...DO SOMETHING WITH THE POJO FIELD...
            return "...SOMETHING...";
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{smvc3java1pojo.east}{[xshift=3mm] smvc3java2pojo1.north}[black][.3][bend left=18mm]
    \drawarrow{smvc3java1pojo.east}{smvc3java2pojo2.north}[black][.3][bend left=18mm]
    \drawarrow{smvc3java1field1.south}{[xshift=-3mm] smvc3xml1field.north}[red]
    \drawarrow{smvc3java1field2.south}{[xshift=-3mm] smvc3xml1field.north}[red]
    \drawarrow{[xshift=3mm] smvc3xml1mapping.south}{smvc3java2mapping1.north}[green]
    \drawarrow{[xshift=3mm] smvc3xml1mapping.south}{smvc3java2mapping2.north}[green]
    \drawarrow{smvc3xml1class}{smvc3java2class}[blue]
    \drawarrow{smvc3xml1meth}{smvc3java2meth}[Magenta]
\end{tikzpicture}
\newpage

\examplenonl[binding dropdown created from map]
%! language = TEXT
\begin{lstlisting}[language=Java, title={POJO class with one String field}]
    public class PojoClass {
        private String dropdownField;
        private LinkedHashMap<String, String> dropdownMap;

        public PojoClass() { // Constructor
            ...dropdownMap initialization...
        }

        public LinkedHashMap<String, String> get(*\tmnbf{smvc4java1map}{DropdownMap}*)() {
            return dropdownMap;
        }

        public String get(*\tmnbf{smvc4java1field1}{DropdownField}*)() {
            return dropdownField;
        }

        public void set(*\tmnbf{smvc4java1field2}{DropdownField}*)(String dropdownField) {
            this.dropdownField = dropdownField;
        }
    }
\end{lstlisting}
%! language = TEXT
\begin{lstlisting}[language=XML, title={HTML form setting the field}]
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org">
      ...
      <body>
        <form ...>
          <select th:field="*{(*\tmnbf{smvc4xml1field}{dropdownField}[ForestGreen]*)}">
            <option th:each="mapEntry: (*\Sc*){mappingId.(*\tmnbf{smvc4xml1map}{dropdownMap}[ForestGreen]*).entrySet()}" th:value="${mapEntry.key}" th:text="${mapEntry.value}"/>
          </select>
        </form>
      </body>
    </html>
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay]
    \drawarrow{smvc4java1map}{smvc4xml1map}
    \drawarrow{smvc4java1field1.south}{smvc4xml1field.north}[red]
    \drawarrow{smvc4java1field2.south}{smvc4xml1field.north}[red]
\end{tikzpicture}

\notenonl Controller would be the same as in the previous example.
\newpage

\example[binding checkbox created from a \textit{properties} file]
\enlargethispage{10mm}
%! language = TEXT
\begin{lstlisting}[language=Java, title={POJO class with one array field}]
    public class PojoClass {
        private String[] checkboxField;

        public String get(*\tmnbf{smvc5java1field1}{CheckboxField}*)() {
            return dropdownField;
        }

        public void set(*\tmnbf{smvc5java1field2}{CheckboxField}*)(String[] checkboxField) {
            this.checkboxField = checkboxField;
        }
    }
\end{lstlisting}
%! language = TEXT
\begin{lstlisting}[language=XML, title={HTML form setting the field}]
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org">
      ...
      <body>
        <form ...>
          <th:block th:each="mapEntry: (*\Sc*){mappingId.(*\tmnbf{smvc5xml1map}{checkboxMap}[ForestGreen]*).entrySet()}">
            <input type="checkbox" name="(*\tmnbf{smvc5xml1field}{checkboxField}[ForestGreen]*)" th:value="(*\Sc*){mapEntry.key}"><span th:text="(*\Sc*){mapEntry.value}"/><br/>
          </select>
        </form>
      </body>
    </html>
\end{lstlisting}
%! language = TEXT
\begin{lstlisting}[language=Java, title={Controller converting \textit{properties} file to a map}]
    @>@Controller
    @@>@RequestMapping<@@("...")
    public class ControllerClass {
        @@>@Value<@@("#{(*\tmnbf{smvc5java2props}{propertiesFileId}[ForestGreen]*)}") // Parsing the properties file
        private val mapFromPropertiesFile: LinkedHashMap<String, String>;

        @>@RequestMapping
        public String showForm(Model model) {
            ...
            model.addAttribute("(*\tmnbf{smvc5java2map}{checkboxMap}[ForestGreen]*)", mapFromPropertiesFile)
            ...
        }
    }
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay, shift={(current page.south west)}]
    \coordinate(smvc5java2propsdummy) at (smvc5java2props |-,0);
    \drawarrow{smvc5java1field1.south}{smvc5xml1field.north}
    \drawarrow{smvc5java1field2.south}{smvc5xml1field.north}
    \drawarrow{smvc5xml1map}{smvc5java2map}[red]
    \drawarrow[stealth-]{[xshift=9mm] smvc5java2props.south}{[xshift=9mm] smvc5java2propsdummy}[green]
\end{tikzpicture}
\newpage

%! language = TEXT
\begin{lstlisting}[language=XML, title={Spring XML configuration}]
    <?xml version="1.0" encoding="UTF-8"?>
    <beans ...>
      ...
      <util:properties id="(*\tmnbf{smvc5xml2props}{propertiesFileId}[ForestGreen]*)" location="WEB-INF/fileName.properties"/>
      ...
    </beans>
\end{lstlisting}
\begin{tikzpicture}[remember picture, overlay, shift={(current page.north west)}]
    \coordinate(smvc5xml2propsdummy) at (smvc5xml2props |-,0);
    \drawarrow[-stealth]{[xshift=-10.9mm] smvc5xml2propsdummy}{[xshift=-10.9mm] smvc5xml2props.north}[green]
\end{tikzpicture}
